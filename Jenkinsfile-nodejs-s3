#!/usr/bin/env groovy

pipeline {
  agent { 
	  label 'kubernetes-master-1'
  }
	
  stages {
    stage('Build docker images') {
      steps {
	      sh "docker build -f /home/ranul/workspace/nodejs-s3/docker/dockerfile-nodejs-s3 -t ranuldeepanayake/private:nodejs-s3 /"
        //sh "docker push ranuldeepanayake/private:nodejs-s3" 
      }
    }

    stage('Deploy on Kubernetes') {
      steps {
        sh 'kubectl apply -f /home/ranul/workspace/nodejs-s3/kubernetes/nodejs-s3-deployment.yml'
        sh 'kubectl apply -f /home/ranul/workspace/nodejs-s3/kubernetes/nodejs-s3-service.yml'
      }
    }
  }
}
